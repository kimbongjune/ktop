<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="partnerCompanyMapper">

    <resultMap id="partnerCompanyFullMap" type="net.ktop.ktop.module.web.partner.PartnerCompanyDto">
	    <id property="id" column="pc_id"/>
	    <result property="descriptionHtml" column="description_html"/>
	    <result property="status" column="status" />
	    <result property="categoryId" column="category_id"/>
	    <result property="createdAt" column="partner_created_at"/>
	    <result property="updatedAt" column="partner_updated_at"/>
	    <result property="deletedAt" column="partner_deleted_at"/>
	
	    <association property="companyDto" javaType="net.ktop.ktop.module.web.company.CompanyDto">
	        <result property="companyName" column="company_name"/>
	        <result property="ceoName" column="ceo_name"/>
	        <result property="phone" column="phone"/>
	        <result property="email" column="email"/>
	        <result property="zipcode" column="zipcode"/>
	        <result property="address1" column="address1"/>
	        <result property="address2" column="address2"/>
	        <result property="homepage" column="homepage"/>
	        <result property="regionId" column="region_id"/>
	        <result property="regionName" column="region_name"/>
	    </association>
	
	    <collection property="companyFileList" ofType="net.ktop.ktop.module.web.company.file.CompanyFileDto">
	        <id property="id" column="cf_id"/>
	        <result property="companyId" column="company_id"/>
	        <result property="fileId" column="file_id"/>
	        <association property="file" javaType="net.ktop.ktop.module.util.file.FileDto">
	            <id property="id" column="f_id"/>
	            <result property="filePath" column="file_path"/>
	            <result property="originalName" column="original_name"/>
	            <result property="fileName" column="file_name"/>
	            <result property="mimeType" column="mime_type"/>
	            <result property="fileSize" column="file_size"/>
	            <result property="createdAt" column="file_created_at"/>
	        </association>
	    </collection>
	</resultMap>





	<select id="getPartnerCompanyOne" parameterType="String" resultMap="partnerCompanyFullMap">
	    SELECT DISTINCT
	        c.company_name,
	        c.ceo_name,
	        c.phone,
	        c.email,
	        c.zipcode,
	        c.address1,
	        c.address2,
	        c.homepage,
	        c.region_id,
	        pc.id AS pc_id,
	        pc.description_html,
	        pc.status,
	        pc.category_id,
	        pc.created_at AS partner_created_at,
	        pc.updated_at AS partner_updated_at,
	        pc.deleted_at AS partner_deleted_at,
	        cf.id AS cf_id,
	        cf.company_id,
	        cf.file_id,
	        f.id AS f_id,
	        f.file_path,
	        f.original_name,
	        f.file_name,
	        f.mime_type,
	        f.file_size,
	        f.created_at AS file_created_at,
	        rc.name AS region_name
	    FROM partner_company pc
	    LEFT JOIN company c ON pc.id = c.id
	    LEFT JOIN company_file cf ON pc.id = cf.company_id
	    LEFT JOIN file f ON cf.file_id = f.id
	    LEFT JOIN region_category rc ON c.region_id = rc.id 
	    WHERE pc.id = #{id}
	</select>


	
	<insert id="insertPartnerOne" parameterType="CompanyDto">
	    INSERT INTO company (
	        id,
	        company_name,
	        ceo_name,
	        phone,
	        email,
	        zipcode,
	        address1,
	        address2,
	        homepage,
	        region_id,
	        description_html
	    ) VALUES (
	        #{id},
	        #{companyName},
	        #{ceoName},
	        #{phone},
	        #{email},
	        #{zipcode},
	        #{address1},
	        #{address2},
	        #{homepage},
	        #{regionId},
	        #{descriptionHtml}
	    )
	</insert>
	
	<update id="updatePartnerOne" parameterType="CompanyDto">
	    UPDATE company
	    SET
	        company_name = #{companyName},
	        ceo_name = #{ceoName},
	        phone = #{phone},
	        email = #{email},
	        zipcode = #{zipcode},
	        address1 = #{address1},
	        address2 = #{address2},
	        homepage = #{homepage},
	        region_id = #{regionId},
	        description_html = #{descriptionHtml},
	        updated_at = NOW()
	    WHERE id = #{id}
	</update>
		
	
	
</mapper>